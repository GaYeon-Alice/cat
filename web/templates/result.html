<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>시험 결과</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/static/css/result.css?v=1.3">
</head>
<body>
    <header>
        <div class="header-container">
            <img src="/static/img/cute_cat.png" alt="Cute Cat" class="cute-cat-image"/>
        </div>
    </header>
    <canvas id="normalDistributionChart" width="900" height="550"></canvas>

    <script>
        // 정규분포 데이터 생성 함수
        function generateNormalDistribution(mean, stdDev, numPoints) {
        const data = [];
        for (let i = 0; i < numPoints; i++) {
            const x = (i - numPoints / 2) / (numPoints / 6);
            const y = (1 / (stdDev * Math.sqrt(2 * Math.PI))) * Math.exp(-((x - mean) ** 2) / (2 * stdDev ** 2));
            data.push({ x, y });
        }
        return data;
        }

        // CDF 계산 함수
        function calculateCDF(value, mean, stdDev) {
        return 0.5 * (1 + erf((value - mean) / (stdDev * Math.sqrt(2))));
        }

        // 오차 함수 (erf) 계산 함수
        function erf(x) {
        const a1 =  0.254829592;
        const a2 = -0.284496736;
        const a3 =  1.421413741;
        const a4 = -1.453152027;
        const a5 =  1.061405429;
        const p  =  0.3275911;

        const sign = (x < 0) ? -1 : 1;
        x = Math.abs(x);

        const t = 1.0 / (1.0 + p * x);
        const y = ((((a5 * t + a4) * t) + a3) * t + a2) * t + a1;

        return sign * (1 - y * Math.exp(-x * x));
        }

        // 평균과 표준편차를 지정하여 정규분포 데이터 생성
        const mean = 0;
        const stdDev = 1;
        const numPoints = 10000;
        const normalDistributionData = generateNormalDistribution(mean, stdDev, numPoints);

        // 특정 값에 대한 CDF 값 계산
        const specificValue = 2.5;

        // 특정 값에 대한 y값 계산 (정규분포 곡선 위의 점)
        const specificValueY = (1 / (stdDev * Math.sqrt(2 * Math.PI))) * Math.exp(-((specificValue - mean) ** 2) / (2 * stdDev ** 2));

        // 특정 값 이상의 영역 데이터 생성
        const shadedRegionData = normalDistributionData.filter(point => point.x >= specificValue);
        
        // 첫 번째 차트(정규분포 그래프) 생성
        const ctx1 = document.getElementById('normalDistributionChart').getContext('2d');
        const normalDistributionChart = new Chart(ctx1, {
        type: 'line',
        data: {
            datasets: [{
            label: 'Specific Value',
            data: [{x: specificValue, y: specificValueY}],
            backgroundColor: 'rgba(106, 148, 0, 1)',
            borderColor: 'rgba(106, 148, 0, 1)',
            borderWidth: 2,
            pointStyle: 'circle',
            pointRadius: 8
            }, {
            label: 'Shaded Region',
            data: shadedRegionData,
            borderColor: 'rgba(121, 168, 0, 1)',
            backgroundColor: 'rgba(141, 195, 0, 0.6)',
            borderWidth: 3,
            fill: true,
            pointStyle: 'hidden',
            pointRadius: 0,
            hoverRadius: 0
            }, {
            label: 'Normal Distribution',
            data: normalDistributionData,
            borderColor: 'rgba(48, 48, 48, 1)',
            borderWidth: 1,
            fill: false,
            pointStyle: 'hidden',
            pointRadius: 0,
            hoverRadius: 0
            }],
        },
        options: {
            scales: {
            x: {
                type: 'linear',
                position: 'bottom',
            },
            y: {
                type: 'linear',
                position: 'left',
                ticks: {
                callback: function(value) {
                    return value;
                }
                }
            },
            },
            plugins: {
            legend: {
                display: false, // 라벨 표시 안 함
            },
            annotation: {
                drawTime: 'afterDatasetsDraw',
                annotations: [{
                type: 'fill',
                xScaleID: 'x',
                yScaleID: 'y',
                xMin: specificValue,
                xMax: Number.POSITIVE_INFINITY,
                yMin: 0,
                yMax: 1,
                backgroundColor: 'rgba(255, 0, 0, 0.2)',
                borderColor: 'rgba(255, 0, 0, 1)',
                borderWidth: 3,
                }]
            },
            tooltip: {
                filter: function(context) {
                    return context.datasetIndex === 0;
                },
                bodyFont: {
                    size: 20
                },
                // 툴팁 내용 사용자 정의
                callbacks: {
                title: function() {
                    return '';
                },
                label: function(context) {
                    const xValue = context.parsed.x; // 현재 점의 x값
                    const cdf = calculateCDF(context.parsed.x, mean, stdDev); // 현재 점에 대한 CDF 계산
                    const percentile = (1 - cdf) * 100; // 상위 백분율 계산
                    return `내 위치: 상위 ${(percentile).toFixed(2)}%`;
                }
                }
            },
            },
        },
        });
    </script>
</body>
</html>